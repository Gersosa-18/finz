name: Keep Render Alive
on:
  schedule:
    - cron: "*/10 * * * *"
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Ping Render
        run: |
          echo "Ping Render..."
          for i in {1..3}; do
            response=$(curl -s -w "\n%{http_code}" --max-time 60 "https://finz-api-o2iy.onrender.com/health")
            http_code=$(echo "$response" | tail -n1)
            body=$(echo "$response" | sed '$d')
            echo "Response: $body"
            echo "HTTP Status: $http_code"
            if [ "$http_code" -eq 200 ]; then
              echo "Render is alive!"
              exit 0
            fi
            echo "Retry $i failed, waiting..."
            sleep 20
          done
          echo "Render is down after 3 attempts."
          exit 1
